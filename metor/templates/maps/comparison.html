{% extends "base.html" %}

{% block extrahead %}
<script src="{{MEDIA_URL}}/js/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="{{MEDIA_URL}}/js/jquery-ui-1.8.7.custom.min.js" type="text/javascript"></script>
<script src="{{MEDIA_URL}}/js/jquery.ui.datepicker-es.js" type="text/javascript"></script>
<link rel="stylesheet" href="{{MEDIA_URL}}/css/jquery-ui-1.8.7.custom.css" type="text/css">

<script type="text/javascript">
    function display_station(station_id, interface_id) {
        var img_windrose = $('#img_windrose__' + interface_id);

        /* TODO: fix este DRY violation con el url */
        $.getJSON('/json/stations/' + station_id + '/', function(station, status){
            img_windrose.attr('src', station.windrose_url);
        });
    }

    function StationInterface(interface_id) {
        var select_station = $('#select_station__' + interface_id);
        var div_station_display = $('#div_station_display__' + interface_id);

        select_station.change(function() {
                display_station(select_station.val(), interface_id);
        });
    }

    $(function() {
            {% for id in display_ids %}
            var si_{{id}} = new StationInterface({{id}});
            {% endfor %}
    });
</script>
{% endblock %}

{% block content %}
{% for id in display_ids %}
<div id="div_station__{{id}}" style="border-style: solid; border-width: 1px;">

    <form>
        <select id="select_station__{{id}}" style="width: 20em;">
            <option value="" selected />
            {% for station in stations %}
            <option value="{{station.stationId}}">{{station.name}}</option>
            {% endfor %}
        </select>
    </form>

    <div id="div_station_display__{{id}}">
        <div id="div_windrose_display__{{id}}">
            <img id="img_windrose__{{id}}" alt="Rosa de Viento"/>
        </div>
    </div>

</div>

<br/>
<hr>
<br/>
{% endfor %}
{% endblock %}
